-- Criação da tabela PHONE_TYPE
CREATE TABLE phone_type (
  phone_type   CHAR(1),
  description  VARCHAR2(20)
);

-- Inserção de dados na tabela PHONE_TYPE
INSERT INTO phone_type (phone_type, description) VALUES ('H', 'Home');

-- Criação da tabela PHONE_NUMBERS
CREATE TABLE phone_numbers (
  phone_number_id   NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  phone_number      VARCHAR2(20),
  phone_type        CHAR(1),
  person_id         NUMBER NOT NULL,
  CONSTRAINT fk_phone_numbers_people FOREIGN KEY (person_id) REFERENCES people(person_id)
);

-- Inserção de dados na tabela PHONE_NUMBERS
INSERT INTO phone_numbers (phone_number, phone_type, person_id)
  SELECT phone_number, 'H', person_id FROM people;

-- Remoção da coluna PHONE_NUMBER da tabela PEOPLE
ALTER TABLE people DROP COLUMN phone_number;

-- Criação da view PEOPLE_VIEW
CREATE OR REPLACE VIEW people_view AS
SELECT
  a.person_id,
  a.first_name,
  a.last_name,
  b.phone_number,
  a.address_line_1,
  a.address_line_2,
  a.city,
  a.state,
  a.zip_code
FROM people a
JOIN phone_numbers b ON b.person_id = a.person_id
WHERE b.phone_type = 'H';
